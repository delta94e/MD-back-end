# Language Mechanics On Escape Analysis â€” CÆ¡ Cháº¿ Escape Analysis

> **TÃ i liá»‡u há»c dÃ nh cho:** NgÆ°á»i má»›i báº¯t Ä‘áº§u, chuáº©n bá»‹ phá»ng váº¥n Senior Golang Software Engineer
> **Nguá»“n gá»‘c:** BÃ i viáº¿t "Language Mechanics On Escape Analysis" cá»§a William Kennedy (2017)
> **GÃ³c nhÃ¬n:** Compiler quyáº¿t Ä‘á»‹nh value á»Ÿ Stack hay Heap â€” khÃ´ng pháº£i programmer!
> **NgÃ´n ngá»¯:** HoÃ n toÃ n báº±ng Tiáº¿ng Viá»‡t

---

## Má»¥c lá»¥c

| #   | Chá»§ Ä‘á»                                 | MÃ´ táº£                                       |
| --- | -------------------------------------- | ------------------------------------------- |
| Â§1  | Heap â€” VÃ¹ng nhá»› thá»© hai                | Heap lÃ  gÃ¬, táº¡i sao "Ä‘áº¯t Ä‘á»"                |
| Â§2  | Sharing Stacks                         | Táº¡i sao goroutines khÃ´ng chia sáº» stack      |
| Â§3  | Escape Mechanics                       | Value semantics vs Pointer semantics return |
| Â§4  | Share Down vs Share Up                 | Xuá»‘ng stack = safe, lÃªn stack = ESCAPE!     |
| Â§5  | Readability & ToÃ¡n tá»­ &                | Táº¡i sao `return &u` tá»‘t hÆ¡n `return u`      |
| Â§6  | Compiler Report                        | go build -gcflags "-m -m"                   |
| Â§7  | Value vs Pointer â€” Tá»•ng há»£p Trade-offs | Báº£ng so sÃ¡nh chi tiáº¿t                       |
| Â§8  | Tá»•ng káº¿t & CÃ¢u há»i phá»ng váº¥n Senior    | Ã”n táº­p & thá»±c hÃ nh                          |

---

## Â§1. Heap â€” VÃ¹ng Nhá»› Thá»© Hai

### 1.1 Heap lÃ  gÃ¬?

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘   HEAP â€” VÃ™NG NHá»š THá»¨ HAI                                    â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                               â•‘
â•‘  Go cÃ³ 2 vÃ¹ng nhá»› chÃ­nh:                                     â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚  STACK                    HEAP                â”‚             â•‘
â•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚             â•‘
â•‘  â”‚  â”‚ Frame C    â”‚         â”‚ â”Œâ”€â”€â” â”Œâ”€â”€â”€â”€â”    â”‚   â”‚             â•‘
â•‘  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”‚ â”‚v1â”‚ â”‚ v2 â”‚    â”‚   â”‚             â•‘
â•‘  â”‚  â”‚ Frame B    â”‚         â”‚ â””â”€â”€â”˜ â””â”€â”€â”€â”€â”˜    â”‚   â”‚             â•‘
â•‘  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”‚    â”Œâ”€â”€â”€â”       â”‚   â”‚             â•‘
â•‘  â”‚  â”‚ Frame A    â”‚         â”‚    â”‚v3 â”‚       â”‚   â”‚             â•‘
â•‘  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚    â””â”€â”€â”€â”˜       â”‚   â”‚             â•‘
â•‘  â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚             â•‘
â•‘  â”‚  âœ… Tá»± dá»n dáº¹p!       âŒ Cáº¦N GC dá»n!       â”‚             â•‘
â•‘  â”‚  âœ… Cá»±c nhanh!         âŒ Cháº­m hÆ¡n!          â”‚             â•‘
â•‘  â”‚  âœ… KhÃ´ng GC!          âŒ 25% CPU cho GC!    â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â•‘
â•‘                                                               â•‘
â•‘  CHI PHÃ Cá»¦A HEAP:                                            â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â•‘
â•‘  â”‚ 1. GC (Garbage Collector) pháº£i dá»n dáº¹p     â”‚             â•‘
â•‘  â”‚    â†’ DÃ¹ng 25% CPU capacity!                  â”‚             â•‘
â•‘  â”‚    â†’ CÃ³ thá»ƒ táº¡o "stop the world" latency!  â”‚             â•‘
â•‘  â”‚    (microseconds nhÆ°ng váº«n Ä‘Ã¡ng ká»ƒ!)        â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ 2. Má»—i value trÃªn Heap = "allocation"       â”‚             â•‘
â•‘  â”‚    â†’ Allocation táº¡o "pressure" lÃªn GC       â”‚             â•‘
â•‘  â”‚    â†’ CÃ ng nhiá»u allocation â†’ GC lÃ m viá»‡c   â”‚             â•‘
â•‘  â”‚      nhiá»u hÆ¡n!                               â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ 3. GC pháº£i kiá»ƒm tra Tá»ªNG value trÃªn Heap   â”‚             â•‘
â•‘  â”‚    â†’ Value nÃ o KHÃ”NG CÃ’N pointer tá»›i?       â”‚             â•‘
â•‘  â”‚    â†’ XÃ³a nÃ³ Ä‘i!                              â”‚             â•‘
â•‘  â”‚    â†’ CÃ ng nhiá»u values â†’ cÃ ng cháº­m!         â”‚             â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â•‘
â•‘                                                               â•‘
â•‘  Lá»¢I ÃCH:                                                     â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â•‘
â•‘  â”‚ â†’ KhÃ´ng cáº§n quáº£n lÃ½ memory thá»§ cÃ´ng!        â”‚             â•‘
â•‘  â”‚ â†’ KhÃ´ng malloc/free nhÆ° C!                    â”‚             â•‘
â•‘  â”‚ â†’ KhÃ´ng memory leaks (GC lo!)                â”‚             â•‘
â•‘  â”‚ â†’ Äá»•i láº¡i: pháº£i HIá»‚U khi nÃ o value lÃªn Heapâ”‚             â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â•‘
â•‘                                                               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## Â§2. Sharing Stacks â€” Goroutines KhÃ´ng Chia Sáº» Stack

### 2.1 Quy táº¯c cÃ¡ch ly Stack

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘   SHARING STACKS â€” GOROUTINES CÃCH LY!                       â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                               â•‘
â•‘  QUY Táº®C:                                                     â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â•‘
â•‘  â”‚ KHÃ”NG goroutine nÃ o Ä‘Æ°á»£c cÃ³ pointer trá» tá»›i â”‚             â•‘
â•‘  â”‚ memory trÃªn stack cá»§a goroutine KHÃC!        â”‚             â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â•‘
â•‘                                                               â•‘
â•‘  Táº I SAO?                                                     â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â•‘
â•‘  â”‚ Stack cá»§a goroutine cÃ³ thá»ƒ THAY Äá»”I!        â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ Goroutine 1:        Goroutine 2:             â”‚             â•‘
â•‘  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚             â•‘
â•‘  â”‚ â”‚ Stack    â”‚       â”‚ Stack    â”‚              â”‚             â•‘
â•‘  â”‚ â”‚ addr: A  â”‚  â†Ã—â”€â”€ â”‚ ptr â†’ A â”‚              â”‚             â•‘
â•‘  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ Khi G1 stack GROW:                            â”‚             â•‘
â•‘  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚             â•‘
â•‘  â”‚ â”‚ NEW Stack    â”‚   â”‚ Stack    â”‚              â”‚             â•‘
â•‘  â”‚ â”‚ addr: B !!!  â”‚   â”‚ ptr â†’ A â”‚ â† DANGLING! â”‚             â•‘
â•‘  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ â†’ Addr A khÃ´ng cÃ²n valid!                    â”‚             â•‘
â•‘  â”‚ â†’ G2's pointer = DANGLING POINTER!           â”‚             â•‘
â•‘  â”‚ â†’ Crash hoáº·c corruption!                    â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ VÃŒ Váº¬Y: Chia sáº» giá»¯a goroutines = HEAP!   â”‚             â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â•‘
â•‘                                                               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## Â§3. Escape Mechanics â€” CÆ¡ Cháº¿ Escape

### 3.1 createUserV1 â€” Value Semantics (KHÃ”NG escape)

```go
// â•â•â• VALUE SEMANTICS â€” KHÃ”NG ESCAPE â•â•â•

// Tráº£ vá» VALUE â†’ COPY lÃªn caller!
func createUserV1() user {     // Return TYPE = user (value!)
    u := user{
        name:  "Bill",
        email: "bill@ardanlabs.com",
    }

    println("V1", &u)
    return u   // â† Return COPY of u!
}
```

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘   createUserV1 â€” VALUE SEMANTICS                              â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                               â•‘
â•‘  SAU KHI return:                                              â•‘
â•‘                                                               â•‘
â•‘  main() stack frame:                                          â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â•‘
â•‘  â”‚ u1 = user{               â”‚ â† Báº¢N SAO!                    â•‘
â•‘  â”‚   name:  "Bill"          â”‚                                 â•‘
â•‘  â”‚   email: "bill@..."      â”‚                                 â•‘
â•‘  â”‚ }                         â”‚                                 â•‘
â•‘  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                 â•‘
â•‘                                                               â•‘
â•‘  createUserV1() stack frame: (ÄÃƒ Bá»Š XÃ“A!)                   â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â•‘
â•‘  â”‚ u = user{                â”‚ â† KHÃ”NG CÃ’N Tá»’N Táº I!        â•‘
â•‘  â”‚   name:  "Bill"          â”‚                                 â•‘
â•‘  â”‚   email: "bill@..."      â”‚                                 â•‘
â•‘  â”‚ }                         â”‚                                 â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â•‘
â•‘                                                               â•‘
â•‘  â†’ u Ä‘Æ°á»£c COPY lÃªn main()                                    â•‘
â•‘  â†’ Frame createUserV1 bá»‹ xÃ³a â†’ KHÃ”NG sao!                  â•‘
â•‘  â†’ Value AN TOÃ€N trÃªn Stack!                                 â•‘
â•‘  â†’ KHÃ”NG escape! KHÃ”NG heap allocation!                      â•‘
â•‘                                                               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### 3.2 createUserV2 â€” Pointer Semantics (ESCAPE!)

```go
// â•â•â• POINTER SEMANTICS â€” ESCAPE LÃŠN HEAP! â•â•â•

// Tráº£ vá» POINTER â†’ SHARE lÃªn caller!
func createUserV2() *user {    // Return TYPE = *user (pointer!)
    u := user{
        name:  "Bill",
        email: "bill@ardanlabs.com",
    }

    println("V2", &u)
    return &u  // â† Return ADDRESS of u! SHARE UP!
}
```

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘   createUserV2 â€” POINTER SEMANTICS                            â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                               â•‘
â•‘  Náº¾U u á»Ÿ Stack (GIáº¢ THUYáº¾T SAI!):                           â•‘
â•‘                                                               â•‘
â•‘  main() stack frame:                                          â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â•‘
â•‘  â”‚ u2 = *user â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚                                 â•‘
â•‘  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                 â•‘
â•‘                             â”‚                                 â•‘
â•‘  createUserV2() frame:      â”‚  (ÄÃƒ Bá»Š XÃ“A!)                 â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                 â•‘
â•‘  â”‚ u = user{            â”‚â—„â”€â”€â”˜  â† DANGLING POINTER!         â•‘
â•‘  â”‚   name: "Bill"       â”‚                                     â•‘
â•‘  â”‚ }                     â”‚      Memory khÃ´ng cÃ²n valid!      â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â•‘
â•‘                                                               â•‘
â•‘  â†’ u2 trá» vÃ o frame ÄÃƒ Bá»Š XÃ“A!                            â•‘
â•‘  â†’ INTEGRITY VIOLATION! BUG!                                 â•‘
â•‘                                                               â•‘
â•‘  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                       â•‘
â•‘                                                               â•‘
â•‘  THá»°C Táº¾ â€” Escape Analysis FIX:                              â•‘
â•‘                                                               â•‘
â•‘  main() stack frame:                                          â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â•‘
â•‘  â”‚ u2 = *user â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â†’ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â•‘
â•‘  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚ user{        â”‚ HEAP!      â•‘
â•‘                                  â”‚  name:"Bill" â”‚            â•‘
â•‘  createUserV2() frame:           â”‚  email:"..." â”‚            â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ }            â”‚            â•‘
â•‘  â”‚ u (local ptr) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â†’ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â•‘
â•‘                                                               â•‘
â•‘  â†’ Compiler phÃ¡t hiá»‡n: u SHARED UP â†’ ESCAPE!                â•‘
â•‘  â†’ user value táº¡o TRÃŠN HEAP ngay tá»« Ä‘áº§u!                   â•‘
â•‘  â†’ u trong createUserV2 = pointer tá»›i Heap!                  â•‘
â•‘  â†’ Sau khi frame xÃ³a, u2 trong main váº«n valid!             â•‘
â•‘  â†’ INTEGRITY Ä‘áº£m báº£o!                                       â•‘
â•‘                                                               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## Â§4. Share Down vs Share Up

### 4.1 Hai hÆ°á»›ng chia sáº»

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘   SHARE DOWN vs SHARE UP â€” HAI HÆ¯á»šNG CHIA Sáºº                â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                               â•‘
â•‘  SHARE DOWN (chia sáº» XUá»NG): AN TOÃ€N!                       â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚  func main() {                                â”‚             â•‘
â•‘  â”‚      u := user{Name: "Bill"}                  â”‚             â•‘
â•‘  â”‚      process(&u)  // Share DOWN!             â”‚             â•‘
â•‘  â”‚  }                                            â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚  func process(u *user) { ... }                â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚  main() frame:                                â”‚             â•‘
â•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚             â•‘
â•‘  â”‚  â”‚ u = user{...}    â”‚ â† value á»Ÿ Ä‘Ã¢y        â”‚             â•‘
â•‘  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚             â•‘
â•‘  â”‚           â”‚ pointer Ä‘i XUá»NG                 â”‚             â•‘
â•‘  â”‚           â–¼                                  â”‚             â•‘
â•‘  â”‚  process() frame:                             â”‚             â•‘
â•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚             â•‘
â•‘  â”‚  â”‚ u = *user â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â†’ trá» LÃŠN main()   â”‚             â•‘
â•‘  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚  â†’ process() Káº¾T THÃšC TRÆ¯á»šC main()!        â”‚             â•‘
â•‘  â”‚  â†’ u trong main() VáºªN CÃ’N sá»‘ng!            â”‚             â•‘
â•‘  â”‚  â†’ AN TOÃ€N! KHÃ”NG cáº§n escape!               â”‚             â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â•‘
â•‘                                                               â•‘
â•‘  SHARE UP (chia sáº» LÃŠN): ESCAPE!                            â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚  func main() {                                â”‚             â•‘
â•‘  â”‚      u := createUser()  // Nháº­n pointer UP!  â”‚             â•‘
â•‘  â”‚  }                                            â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚  func createUser() *user {                    â”‚             â•‘
â•‘  â”‚      u := user{Name: "Bill"}                  â”‚             â•‘
â•‘  â”‚      return &u  // Share UP! ESCAPE!         â”‚             â•‘
â•‘  â”‚  }                                            â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚  main() frame:                                â”‚             â•‘
â•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚             â•‘
â•‘  â”‚  â”‚ u = *user â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â†’ â”Œâ”€â”€â”€â”€â”€â”€â” HEAP!    â”‚             â•‘
â•‘  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ user â”‚           â”‚             â•‘
â•‘  â”‚                          â””â”€â”€â”€â”€â”€â”€â”˜           â”‚             â•‘
â•‘  â”‚  createUser() frame: (ÄÃƒ XÃ“A!)             â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚  â†’ createUser() Káº¾T THÃšC!                   â”‚             â•‘
â•‘  â”‚  â†’ Náº¿u value trÃªn stack â†’ DANGLING!         â”‚             â•‘
â•‘  â”‚  â†’ Compiler chuyá»ƒn value lÃªn HEAP!           â”‚             â•‘
â•‘  â”‚  â†’ ESCAPE!                                    â”‚             â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â•‘
â•‘                                                               â•‘
â•‘  QUY Táº®C VÃ€NG:                                                â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â•‘
â•‘  â”‚ Share DOWN = STACK (an toÃ n, nhanh!)         â”‚             â•‘
â•‘  â”‚ Share UP   = HEAP  (escape, GC pressure!)    â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ "Anytime a value is shared outside the scope â”‚             â•‘
â•‘  â”‚  of a function's stack frame, it will be     â”‚             â•‘
â•‘  â”‚  placed (or allocated) on the HEAP."         â”‚             â•‘
â•‘  â”‚                                â€” Kennedy     â”‚             â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â•‘
â•‘                                                               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## Â§5. Readability & ToÃ¡n Tá»­ &

### 5.1 Táº¡i sao `return &u` tá»‘t hÆ¡n

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘   READABILITY â€” TOÃN Tá»¬ & = "SHARING"!                      â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                               â•‘
â•‘  Kennedy:                                                      â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â•‘
â•‘  â”‚ "Replace the & operator for the word         â”‚             â•‘
â•‘  â”‚  SHARING as you read code."                  â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ & = SHARING!                                 â”‚             â•‘
â•‘  â”‚ Äá»c & nhÆ° "chia sáº»"!                        â”‚             â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â•‘
â•‘                                                               â•‘
â•‘  SO SÃNH 2 CÃCH VIáº¾T:                                         â•‘
â•‘                                                               â•‘
â•‘  âŒ Pointer semantics construction (Máº¤T readability):        â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â•‘
â•‘  â”‚ func createUserV2() *user {                   â”‚             â•‘
â•‘  â”‚     u := &user{              // u lÃ  *user!  â”‚             â•‘
â•‘  â”‚         name:  "Bill",                        â”‚             â•‘
â•‘  â”‚         email: "bill@...",                    â”‚             â•‘
â•‘  â”‚     }                                         â”‚             â•‘
â•‘  â”‚     return u     // â† Return copy of u       â”‚             â•‘
â•‘  â”‚ }                //   KhÃ´ng tháº¥y SHARING!    â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ Äá»c "return u" â†’ "tráº£ báº£n sao u"           â”‚             â•‘
â•‘  â”‚ NHÆ¯NG thá»±c táº¿ u lÃ  *pointer â†’ share!         â”‚             â•‘
â•‘  â”‚ â†’ KHÃ”NG RÃ• RÃ€NG!                            â”‚             â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â•‘
â•‘                                                               â•‘
â•‘  âœ… Value semantics construction (RÃ• RÃ€NG):                  â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â•‘
â•‘  â”‚ func createUserV2() *user {                   â”‚             â•‘
â•‘  â”‚     u := user{               // u lÃ  user!    â”‚             â•‘
â•‘  â”‚         name:  "Bill",                        â”‚             â•‘
â•‘  â”‚         email: "bill@...",                    â”‚             â•‘
â•‘  â”‚     }                                         â”‚             â•‘
â•‘  â”‚     return &u    // â† Return SHARING of u!   â”‚             â•‘
â•‘  â”‚ }                //   THáº¤Y RÃ• & = SHARING!  â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ Äá»c "return &u" â†’ "chia sáº» u lÃªn caller!"  â”‚             â•‘
â•‘  â”‚ â†’ RÃ• RÃ€NG! BIáº¾T NGAY value sáº½ escape!      â”‚             â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â•‘
â•‘                                                               â•‘
â•‘  VÃ Dá»¤ json.Unmarshal:                                        â•‘
â•‘                                                               â•‘
â•‘  âŒ Pointer construction (KHÃ”NG RÃ•):                         â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â•‘
â•‘  â”‚ var u *user                   // pointer     â”‚             â•‘
â•‘  â”‚ err := json.Unmarshal(data, &u) // share    â”‚             â•‘
â•‘  â”‚ return u, err                // copy ptr     â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ â†’ KhÃ´ng rÃµ user value Ä‘Æ°á»£c táº¡o á»Ÿ Ä‘Ã¢u!      â”‚             â•‘
â•‘  â”‚ â†’ KhÃ´ng rÃµ ai Ä‘ang share gÃ¬!               â”‚             â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â•‘
â•‘                                                               â•‘
â•‘  âœ… Value construction (RÃ• RÃ€NG):                             â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â•‘
â•‘  â”‚ var u user                    // VALUE!       â”‚             â•‘
â•‘  â”‚ err := json.Unmarshal(data, &u) // SHARE â†“  â”‚             â•‘
â•‘  â”‚ return &u, err               // SHARE â†‘     â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ Line 1: Táº¡o user VALUE                       â”‚             â•‘
â•‘  â”‚ Line 2: SHARE u XUá»NG json.Unmarshal         â”‚             â•‘
â•‘  â”‚ Line 3: SHARE u LÃŠN caller                  â”‚             â•‘
â•‘  â”‚ â†’ Má»i thá»© RÃ• RÃ€NG!                         â”‚             â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â•‘
â•‘                                                               â•‘
â•‘  NGUYÃŠN Táº®C:                                                  â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â•‘
â•‘  â”‚ "Use VALUE SEMANTICS when constructing a     â”‚             â•‘
â•‘  â”‚  value and leverage the READABILITY of the   â”‚             â•‘
â•‘  â”‚  & operator to make it clear how values      â”‚             â•‘
â•‘  â”‚  are being shared."                           â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ â†’ Construction = value (u := user{...})      â”‚             â•‘
â•‘  â”‚ â†’ Sharing = dÃ¹ng & (return &u)               â”‚             â•‘
â•‘  â”‚ â†’ Äá»c code = BIáº¾T NGAY value Ä‘i Ä‘Ã¢u!       â”‚             â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â•‘
â•‘                                                               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## Â§6. Compiler Report â€” go build -gcflags "-m -m"

### 6.1 Äá»c Escape Analysis Report

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘   COMPILER REPORT â€” ESCAPE ANALYSIS                           â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                               â•‘
â•‘  Lá»†NH:                                                        â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â•‘
â•‘  â”‚ $ go build -gcflags "-m -m"                   â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ -m     = report level 1 (cÆ¡ báº£n)            â”‚             â•‘
â•‘  â”‚ -m -m  = report level 2 (chi tiáº¿t!)         â”‚             â•‘
â•‘  â”‚ -m -m -m = level 3 (quÃ¡ nhiá»u thÃ´ng tin!)   â”‚             â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â•‘
â•‘                                                               â•‘
â•‘  Káº¾T QUáº¢ REPORT:                                              â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â•‘
â•‘  â”‚ ./main.go:22: createUserV1 &u does NOT escapeâ”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ â†’ println("V1", &u) KHÃ”NG gÃ¢y escape!       â”‚             â•‘
â•‘  â”‚ â†’ Máº·c dÃ¹ &u truyá»n vÃ o println             â”‚             â•‘
â•‘  â”‚ â†’ println Ä‘áº·c biá»‡t, compiler biáº¿t an toÃ n! â”‚             â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â•‘
â•‘                                                               â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â•‘
â•‘  â”‚ ./main.go:34: &u escapes to heap             â”‚             â•‘
â•‘  â”‚ ./main.go:34:   from ~r0 (return) at :34     â”‚             â•‘
â•‘  â”‚ ./main.go:31: moved to heap: u               â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ â†’ u á»Ÿ dÃ²ng 31 PHáº¢I chuyá»ƒn lÃªn HEAP!        â”‚             â•‘
â•‘  â”‚ â†’ LÃ½ do: return trÃªn dÃ²ng 34!               â”‚             â•‘
â•‘  â”‚ â†’ ~r0 = return value!                         â”‚             â•‘
â•‘  â”‚ â†’ Value SHARED UP â†’ ESCAPE!                  â”‚             â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â•‘
â•‘                                                               â•‘
â•‘  CÃCH Äá»ŒC REPORT:                                             â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ "does NOT escape"                             â”‚             â•‘
â•‘  â”‚ â†’ Value AN TOÃ€N trÃªn Stack! âœ…               â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ "escapes to heap"                             â”‚             â•‘
â•‘  â”‚ â†’ Value PHáº¢I lÃªn Heap! âŒ                    â”‚             â•‘
â•‘  â”‚ â†’ TÃ¬m dÃ²ng "from..." Ä‘á»ƒ biáº¿t Táº I SAO!     â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ "moved to heap: X"                            â”‚             â•‘
â•‘  â”‚ â†’ Biáº¿n X Ä‘Ã£ bá»‹ DI CHUYá»‚N lÃªn Heap!         â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ LÃ DO PHá»” BIáº¾N:                              â”‚             â•‘
â•‘  â”‚ â€¢ "from ~r0 (return)" = share UP qua return  â”‚             â•‘
â•‘  â”‚ â€¢ "interface-converted" = gÃ¡n vÃ o interface  â”‚             â•‘
â•‘  â”‚ â€¢ "too large for stack" = size unknown/big   â”‚             â•‘
â•‘  â”‚ â€¢ "passed to call" = truyá»n qua function    â”‚             â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â•‘
â•‘                                                               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### 6.2 Named type vs Literal type â€” Report khÃ¡c nhau!

```go
// â•â•â• NAMED TYPE vs LITERAL TYPE â€” REPORT KHÃC NHAU! â•â•â•

// NAMED TYPE (u lÃ  user):
func createUserV2() *user {
    u := user{              // u = named type "user"
        name: "Bill",
        email: "bill@...",
    }
    return &u
}
// Report:
// ./main.go:34: &u escapes to heap
// ./main.go:31: moved to heap: u

// LITERAL TYPE (u lÃ  *user):
func createUserV2() *user {
    u := &user{             // u = literal type "*user"
        name: "Bill",
        email: "bill@...",
    }
    return u
}
// Report:
// ./main.go:30: &user literal escapes to heap
// â†’ KhÃ¡c cÃ¡ch diá»…n Ä‘áº¡t nhÆ°ng CÃ™NG Káº¾T QUáº¢!
// â†’ Cáº£ 2 Ä‘á»u ESCAPE lÃªn Heap!
```

---

## Â§7. Value vs Pointer â€” Tá»•ng Há»£p Trade-offs

### 7.1 Báº£ng so sÃ¡nh chi tiáº¿t

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘   VALUE vs POINTER SEMANTICS â€” TRADE-OFFS                     â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                               â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â•‘
â•‘  â”‚ TiÃªu chÃ­        â”‚ VALUE SEM.     â”‚ POINTER SEM.      â”‚    â•‘
â•‘  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â•‘
â•‘  â”‚ Vá»‹ trÃ­ memory  â”‚ STACK âœ…       â”‚ HEAP âŒ           â”‚    â•‘
â•‘  â”‚ GC pressure     â”‚ KHÃ”NG âœ…       â”‚ CÃ“ âŒ            â”‚    â•‘
â•‘  â”‚ Tá»‘c Ä‘á»™ access  â”‚ TRá»°C TIáº¾P âœ…  â”‚ QUA POINTER âŒ   â”‚    â•‘
â•‘  â”‚ Copy            â”‚ NHIá»€U copies âŒâ”‚ 1 value âœ…       â”‚    â•‘
â•‘  â”‚ Side effects    â”‚ KHÃ”NG âœ…       â”‚ CÃ“ THá»‚ âŒ       â”‚    â•‘
â•‘  â”‚ Data races      â”‚ AN TOÃ€N âœ…     â”‚ NGUY HIá»‚M âŒ    â”‚    â•‘
â•‘  â”‚ Mutation        â”‚ Táº¡o Má»šI âœ…    â”‚ In-place âŒ       â”‚    â•‘
â•‘  â”‚ Sharing         â”‚ Copy riÃªng âœ… â”‚ Chia sáº» gá»‘c âœ…  â”‚    â•‘
â•‘  â”‚ Readability     â”‚ return &u âœ…   â”‚ return u ğŸ”¶     â”‚    â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â•‘
â•‘                                                               â•‘
â•‘  KHI NÃ€O CHá»ŒN GÃŒ:                                            â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ VALUE SEMANTICS khi:                          â”‚             â•‘
â•‘  â”‚ â†’ Data NHá», copy ráº» (int, string, struct   â”‚             â•‘
â•‘  â”‚   nhá»)                                       â”‚             â•‘
â•‘  â”‚ â†’ Built-in types (int, float, bool, string)  â”‚             â•‘
â•‘  â”‚ â†’ Reference types (slice, map, channel)      â”‚             â•‘
â•‘  â”‚ â†’ KHÃ”NG cáº§n mutation tháº¥y á»Ÿ má»i nÆ¡i       â”‚             â•‘
â•‘  â”‚ â†’ time.Time, net.IP, Color, Point           â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ POINTER SEMANTICS khi:                        â”‚             â•‘
â•‘  â”‚ â†’ Data Lá»šN, copy Ä‘áº¯t                       â”‚             â•‘
â•‘  â”‚ â†’ Struct giá»¯ RESOURCE (file, conn, mutex)    â”‚             â•‘
â•‘  â”‚ â†’ Cáº¦N mutation tháº¥y á»Ÿ má»i nÆ¡i             â”‚             â•‘
â•‘  â”‚ â†’ Unmarshaling (luÃ´n pointer!)               â”‚             â•‘
â•‘  â”‚ â†’ os.File, sql.DB, http.Server              â”‚             â•‘
â•‘  â”‚ â†’ KHÃ”NG CHáº®C? â†’ Pointer!                    â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â•‘
â•‘                                                               â•‘
â•‘  Kennedy:                                                      â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â•‘
â•‘  â”‚ "The construction of a value doesn't         â”‚             â•‘
â•‘  â”‚  determine where it lives. Only how a value  â”‚             â•‘
â•‘  â”‚  is SHARED will determine what the compiler  â”‚             â•‘
â•‘  â”‚  will do with that value."                   â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ â†’ CÃCH Táº O value â‰  quyáº¿t Ä‘á»‹nh vá»‹ trÃ­!     â”‚             â•‘
â•‘  â”‚ â†’ CÃCH CHIA Sáºº value = quyáº¿t Ä‘á»‹nh!         â”‚             â•‘
â•‘  â”‚ â†’ Share UP = ESCAPE!                         â”‚             â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â•‘
â•‘                                                               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## Â§8. Tá»•ng Káº¿t & CÃ¢u Há»i Phá»ng Váº¥n Senior Golang

### 8.1 CÃ¢u há»i phá»ng váº¥n

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘   CÃ‚U Há»I PHá»NG Váº¤N SENIOR GOLANG                            â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                               â•‘
â•‘  Q1: "Escape Analysis lÃ  gÃ¬? Compiler quyáº¿t Ä‘á»‹nh gÃ¬?"       â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â•‘
â•‘  â”‚ = QuÃ¡ trÃ¬nh compiler phÃ¢n tÃ­ch TÄ¨NH (static â”‚             â•‘
â•‘  â”‚ code analysis) Ä‘á»ƒ quyáº¿t Ä‘á»‹nh value á»Ÿ Stack  â”‚             â•‘
â•‘  â”‚ hay Heap!                                     â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ â†’ KhÃ´ng cÃ³ keyword nÃ o trong Go Ä‘á»ƒ chá»‰ Ä‘á»‹nh!â”‚             â•‘
â•‘  â”‚ â†’ Chá»‰ CÃCH VIáº¾T CODE quyáº¿t Ä‘á»‹nh!            â”‚             â•‘
â•‘  â”‚ â†’ Share UP = escape lÃªn Heap!                â”‚             â•‘
â•‘  â”‚ â†’ Share DOWN = an toÃ n trÃªn Stack!           â”‚             â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â•‘
â•‘                                                               â•‘
â•‘  Q2: "Táº¡i sao goroutines khÃ´ng chia sáº» stack?"              â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â•‘
â•‘  â”‚ â†’ Stack goroutine cÃ³ thá»ƒ GROW/SHRINK!        â”‚             â•‘
â•‘  â”‚ â†’ Grow = cáº¥p block memory Má»šI, addr THAY Äá»”Iâ”‚             â•‘
â•‘  â”‚ â†’ Pointer tá»« goroutine khÃ¡c â†’ DANGLING!      â”‚             â•‘
â•‘  â”‚ â†’ Tracking cross-goroutine pointers = quÃ¡    â”‚             â•‘
â•‘  â”‚   phá»©c táº¡p, "stop the world" latency!       â”‚             â•‘
â•‘  â”‚ â†’ Giáº£i phÃ¡p: chia sáº» qua HEAP!              â”‚             â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â•‘
â•‘                                                               â•‘
â•‘  Q3: "Táº¡i sao `return &u` tá»‘t hÆ¡n `return u`               â•‘
â•‘       khi u lÃ  *user?"                                        â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â•‘
â•‘  â”‚ return &u â†’ THáº¤Y RÃ• "&" = SHARING!          â”‚             â•‘
â•‘  â”‚ â†’ Äá»c code biáº¿t ngay: value chia sáº» LÃŠN!  â”‚             â•‘
â•‘  â”‚ â†’ Biáº¿t ngay sáº½ escape lÃªn Heap!             â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ return u (khi u = *user) â†’ khÃ´ng tháº¥y share! â”‚             â•‘
â•‘  â”‚ â†’ Pháº£i nhá»› u lÃ  pointer                     â”‚             â•‘
â•‘  â”‚ â†’ Máº¥t readability!                            â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ â†’ DÃ¹ng value semantics cho construction!     â”‚             â•‘
â•‘  â”‚ â†’ DÃ¹ng & operator cho sharing!               â”‚             â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â•‘
â•‘                                                               â•‘
â•‘  Q4: "LÃ m sao xem Escape Analysis Report?"                  â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â•‘
â•‘  â”‚ $ go build -gcflags "-m -m"                   â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ Äá»c káº¿t quáº£:                                 â”‚             â•‘
â•‘  â”‚ â€¢ "does not escape" = Stack âœ…               â”‚             â•‘
â•‘  â”‚ â€¢ "escapes to heap" = Heap âŒ                â”‚             â•‘
â•‘  â”‚ â€¢ "moved to heap: X" = X bá»‹ chuyá»ƒn Heap    â”‚             â•‘
â•‘  â”‚ â€¢ Xem "from..." Ä‘á»ƒ biáº¿t LÃ DO escape!      â”‚             â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â•‘
â•‘                                                               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### 8.2 Tá»•ng káº¿t

```
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Tá»”NG Káº¾T: ESCAPE ANALYSIS                              â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                                                          â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
    â”‚  â”‚ 1. Escape Analysis = COMPILER quyáº¿t Ä‘á»‹nh â”‚            â”‚
    â”‚  â”‚    â†’ KhÃ´ng cÃ³ keyword nÃ o!                â”‚            â”‚
    â”‚  â”‚    â†’ CÃ¡ch viáº¿t code = quyáº¿t Ä‘á»‹nh!         â”‚            â”‚
    â”‚  â”‚                                          â”‚            â”‚
    â”‚  â”‚ 2. Share UP = ESCAPE lÃªn Heap!            â”‚            â”‚
    â”‚  â”‚    Share DOWN = AN TOÃ€N trÃªn Stack!       â”‚            â”‚
    â”‚  â”‚                                          â”‚            â”‚
    â”‚  â”‚ 3. Construction â‰  vá»‹ trÃ­ memory!          â”‚            â”‚
    â”‚  â”‚    â†’ u := user{} cÃ³ thá»ƒ á»Ÿ Stack hoáº·c    â”‚            â”‚
    â”‚  â”‚      Heap tÃ¹y vÃ o cÃ¡ch SHARE!             â”‚            â”‚
    â”‚  â”‚                                          â”‚            â”‚
    â”‚  â”‚ 4. & = "SHARING" â€” Ä‘á»c code RÃ• RÃ€NG!    â”‚            â”‚
    â”‚  â”‚    â†’ return &u = "chia sáº» u lÃªn caller" â”‚            â”‚
    â”‚  â”‚                                          â”‚            â”‚
    â”‚  â”‚ 5. go build -gcflags "-m -m"              â”‚            â”‚
    â”‚  â”‚    â†’ Xem chÃ­nh xÃ¡c value nÃ o escape!      â”‚            â”‚
    â”‚  â”‚    â†’ Xem lÃ½ do táº¡i sao escape!            â”‚            â”‚
    â”‚  â”‚                                          â”‚            â”‚
    â”‚  â”‚ 6. KEY: correctness, consistency,         â”‚            â”‚
    â”‚  â”‚    balance giá»¯a value/pointer semantics   â”‚            â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
    â”‚                                                          â”‚
    â”‚  William Kennedy:                                        â”‚
    â”‚  "The construction of a value doesn't determine         â”‚
    â”‚   where it lives. Only HOW a value is SHARED            â”‚
    â”‚   will determine what the compiler will do              â”‚
    â”‚   with that value."                                     â”‚
    â”‚                                                          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
