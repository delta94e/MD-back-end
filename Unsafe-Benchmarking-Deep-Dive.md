# Unsafe Pointer & Go Benchmarking â€” Chuyá»ƒn Äá»•i Bytes Sang String & Äo Hiá»‡u Suáº¥t

> **TÃ i liá»‡u há»c dÃ nh cho:** NgÆ°á»i má»›i báº¯t Ä‘áº§u, chuáº©n bá»‹ phá»ng váº¥n Senior Golang Software Engineer
> **Nguá»“n gá»‘c:** William Kennedy â€” Ultimate Go / Go internal mechanics
> **GÃ³c nhÃ¬n:** unsafe.Pointer, Memory Layout, Benchmarking, Performance Measurement
> **NgÃ´n ngá»¯:** HoÃ n toÃ n báº±ng Tiáº¿ng Viá»‡t

---

## Má»¥c lá»¥c

| #   | Chá»§ Ä‘á»                              | MÃ´ táº£                                   |
| --- | ----------------------------------- | --------------------------------------- |
| Â§1  | Memory Layout: string vs []byte     | Internal representation, header structs |
| Â§2  | Safe Conversion: string(b)          | Copy data, an toÃ n, khi nÃ o dÃ¹ng        |
| Â§3  | Unsafe Conversion: unsafe.Pointer   | Zero-copy, nguy hiá»ƒm, cÃ¡ch hoáº¡t Ä‘á»™ng    |
| Â§4  | unsafe.Pointer Deep Dive            | Pointer rules, type punning, safety     |
| Â§5  | Go Benchmarking CÆ¡ Báº£n              | testing.B, b.N, -bench, -benchmem       |
| Â§6  | Benchmark Sprint vs Sprintf         | PhÃ¢n tÃ­ch code máº«u, káº¿t quáº£, Ã½ nghÄ©a    |
| Â§7  | Best Practices Benchmarking         | TrÃ¡nh compiler optimization, profile    |
| Â§8  | Tá»•ng káº¿t & CÃ¢u há»i phá»ng váº¥n Senior | Ã”n táº­p & thá»±c hÃ nh                      |

---

## Â§1. Memory Layout: string vs []byte

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘   STRING vs []BYTE â€” INTERNAL REPRESENTATION                  â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                               â•‘
â•‘  CÃ™NG Ná»˜I DUNG â€” KHÃC Cáº¤U TRÃšC!                              â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚  string "HELLO":                              â”‚             â•‘
â•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” = StringHeaderâ•‘
â•‘  â”‚  â”‚ ptr â”€â”€â†’ [H][E][L][L][O]     â”‚ 16 bytes    â”‚             â•‘
â•‘  â”‚  â”‚ len: 5                       â”‚             â”‚             â•‘
â•‘  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚             â•‘
â•‘  â”‚  â†’ CHá»ˆ CÃ“ 2 fields: ptr + len!              â”‚             â•‘
â•‘  â”‚  â†’ IMMUTABLE! KhÃ´ng thá»ƒ thay Ä‘á»•i bytes!     â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•             â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚  []byte{'H','E','L','L','O'}:                â”‚             â•‘
â•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” = SliceHeaderâ•‘
â•‘  â”‚  â”‚ ptr â”€â”€â†’ [H][E][L][L][O][ ][ ]â”‚ 24 bytes   â”‚             â•‘
â•‘  â”‚  â”‚ len: 5                       â”‚             â”‚             â•‘
â•‘  â”‚  â”‚ cap: 7                       â”‚             â”‚             â•‘
â•‘  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚             â•‘
â•‘  â”‚  â†’ CÃ“ 3 fields: ptr + len + cap!             â”‚             â•‘
â•‘  â”‚  â†’ MUTABLE! CÃ³ thá»ƒ thay Ä‘á»•i bytes!          â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â•‘
â•‘                                                               â•‘
â•‘  GO INTERNAL (reflect package):                                â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚  // reflect.StringHeader (deprecated nhÆ°ng    â”‚             â•‘
â•‘  â”‚  // váº«n minh há»a tá»‘t)                       â”‚             â•‘
â•‘  â”‚  type StringHeader struct {                   â”‚             â•‘
â•‘  â”‚      Data uintptr    // pointer to bytes      â”‚             â•‘
â•‘  â”‚      Len  int        // length in bytes       â”‚             â•‘
â•‘  â”‚  }                                            â”‚             â•‘
â•‘  â”‚  // Size: 16 bytes (64-bit)                   â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚  // reflect.SliceHeader                       â”‚             â•‘
â•‘  â”‚  type SliceHeader struct {                    â”‚             â•‘
â•‘  â”‚      Data uintptr    // pointer to array      â”‚             â•‘
â•‘  â”‚      Len  int        // current length        â”‚             â•‘
â•‘  â”‚      Cap  int        // capacity              â”‚             â•‘
â•‘  â”‚  }                                            â”‚             â•‘
â•‘  â”‚  // Size: 24 bytes (64-bit)                   â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚  SO SÃNH:                                     â”‚             â•‘
â•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚             â•‘
â•‘  â”‚  â”‚          â”‚ string       â”‚ []byte        â”‚ â”‚             â•‘
â•‘  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚             â•‘
â•‘  â”‚  â”‚ Fields   â”‚ ptr + len    â”‚ ptr + len+cap â”‚ â”‚             â•‘
â•‘  â”‚  â”‚ Size     â”‚ 16 bytes     â”‚ 24 bytes      â”‚ â”‚             â•‘
â•‘  â”‚  â”‚ Mutable  â”‚ âŒ IMMUTABLE â”‚ âœ… MUTABLE    â”‚ â”‚             â•‘
â•‘  â”‚  â”‚ Safe     â”‚ âœ… Thread-safeâ”‚ âŒ Race cond â”‚ â”‚             â•‘
â•‘  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â•‘
â•‘                                                               â•‘
â•‘  ÄIá»‚M Máº¤U CHá»T:                                               â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â•‘
â•‘  â”‚ â†’ string vÃ  []byte CÃ“ CÃ™NG 2 fields Ä‘áº§u!  â”‚             â•‘
â•‘  â”‚ â†’ ptr + len GIá»NG NHAU!                      â”‚             â•‘
â•‘  â”‚ â†’ []byte chá»‰ THÃŠM cap!                      â”‚             â•‘
â•‘  â”‚ â†’ VÃ¬ váº­y cÃ³ thá»ƒ "trick" cast giá»¯a chÃºng!  â”‚             â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â•‘
â•‘                                                               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## Â§2. Safe Conversion: string(b)

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘   SAFE CONVERSION â€” COPY DATA!                                â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                               â•‘
â•‘  CODE:                                                         â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â•‘
â•‘  â”‚ func SafeBytesToString(b []byte) string {     â”‚             â•‘
â•‘  â”‚     return string(b)  // â† COPY TOÃ€N Bá»˜!    â”‚             â•‘
â•‘  â”‚ }                                             â”‚             â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â•‘
â•‘                                                               â•‘
â•‘  CHUYá»†N GÃŒ Xáº¢Y RA?                                            â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚  TRÆ¯á»šC:                                       â”‚             â•‘
â•‘  â”‚  b ([]byte):                                  â”‚             â•‘
â•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚             â•‘
â•‘  â”‚  â”‚ ptr â”€â”€â†’ [H][E][L][L][O]â”‚ (address 0x100) â”‚             â•‘
â•‘  â”‚  â”‚ len: 5                  â”‚                  â”‚             â•‘
â•‘  â”‚  â”‚ cap: 5                  â”‚                  â”‚             â•‘
â•‘  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚  SAU string(b):                               â”‚             â•‘
â•‘  â”‚  1. Go runtime ALLOCATE vÃ¹ng nhá»› Má»šI!      â”‚             â•‘
â•‘  â”‚  2. COPY "HELLO" sang vÃ¹ng nhá»› má»›i!         â”‚             â•‘
â•‘  â”‚  3. Táº¡o string header trá» Ä‘áº¿n vÃ¹ng Má»šI!   â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚  b ([]byte):                                  â”‚             â•‘
â•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚             â•‘
â•‘  â”‚  â”‚ ptr â”€â”€â†’ [H][E][L][L][O]â”‚ (0x100)          â”‚             â•‘
â•‘  â”‚  â”‚ len: 5  â”‚ cap: 5       â”‚                  â”‚             â•‘
â•‘  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚  s (string):         Báº¢N COPY!               â”‚             â•‘
â•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚             â•‘
â•‘  â”‚  â”‚ ptr â”€â”€â†’ [H][E][L][L][O]â”‚ (0x200) Má»šI!    â”‚             â•‘
â•‘  â”‚  â”‚ len: 5                  â”‚                  â”‚             â•‘
â•‘  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚  â†’ 2 báº£n copy KHÃC NHAU trong memory!       â”‚             â•‘
â•‘  â”‚  â†’ Thay Ä‘á»•i b[0]='X' â†’ s KHÃ”NG Ä‘á»•i!        â”‚             â•‘
â•‘  â”‚  â†’ AN TOÃ€N! string váº«n immutable!           â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â•‘
â•‘                                                               â•‘
â•‘  CHI PHÃ:                                                      â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â•‘
â•‘  â”‚ â†’ Allocation: runtime pháº£i allocate memory! â”‚             â•‘
â•‘  â”‚ â†’ Copy: memcpy N bytes!                       â”‚             â•‘
â•‘  â”‚ â†’ GC Pressure: thÃªm object cho GC track!    â”‚             â•‘
â•‘  â”‚ â†’ Vá»›i data NHá»: khÃ´ng Ä‘Ã¡ng lo!              â”‚             â•‘
â•‘  â”‚ â†’ Vá»›i data Lá»šN + HOT PATH: Cá»° TRá»Š!        â”‚             â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â•‘
â•‘                                                               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## Â§3. Unsafe Conversion: unsafe.Pointer â€” ZERO COPY!

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘   UNSAFE CONVERSION â€” KHÃ”NG COPY! NGUY HIá»‚M!                 â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                               â•‘
â•‘  CODE:                                                         â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â•‘
â•‘  â”‚ func UnsafeBytesToString(b []byte) string {   â”‚             â•‘
â•‘  â”‚     return *(*string)(unsafe.Pointer(&b))     â”‚             â•‘
â•‘  â”‚ }                                             â”‚             â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â•‘
â•‘                                                               â•‘
â•‘  PHÃ‚N TÃCH Tá»ªNG BÆ¯á»šC:                                          â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚  BÆ°á»›c 1: &b = láº¥y Ä‘á»‹a chá»‰ cá»§a slice header â”‚             â•‘
â•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚             â•‘
â•‘  â”‚  â”‚ &b = 0xABC (address of b)    â”‚            â”‚             â•‘
â•‘  â”‚  â”‚                              â”‚            â”‚             â•‘
â•‘  â”‚  â”‚ Táº¡i 0xABC:                   â”‚            â”‚             â•‘
â•‘  â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â” offset 0: ptr       â”‚            â”‚             â•‘
â•‘  â”‚  â”‚ â”œâ”€â”€â”€â”€â”€â”€â”¤ offset 8: len       â”‚            â”‚             â•‘
â•‘  â”‚  â”‚ â”œâ”€â”€â”€â”€â”€â”€â”¤ offset 16: cap      â”‚            â”‚             â•‘
â•‘  â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”˜                     â”‚            â”‚             â•‘
â•‘  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚  BÆ°á»›c 2: unsafe.Pointer(&b) = cast sang     â”‚             â•‘
â•‘  â”‚          generic pointer (khÃ´ng cÃ³ type!)    â”‚             â•‘
â•‘  â”‚  â†’ BÃ¢y giá» Go KHÃ”NG BIáº¾T Ä‘Ã¢y lÃ  gÃ¬!        â”‚             â•‘
â•‘  â”‚  â†’ Chá»‰ lÃ  "má»™t vÃ¹ng memory á»Ÿ 0xABC"        â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚  BÆ°á»›c 3: (*string)(unsafe.Pointer(&b)) =    â”‚             â•‘
â•‘  â”‚          cast thÃ nh *string!                  â”‚             â•‘
â•‘  â”‚  â†’ Go NGHÄ¨ vÃ¹ng 0xABC lÃ  StringHeader!     â”‚             â•‘
â•‘  â”‚  â†’ Äá»c 16 bytes Ä‘áº§u = ptr + len!           â”‚             â•‘
â•‘  â”‚  â†’ Bá» QUA cap (byte thá»© 17-24)!             â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚  BÆ°á»›c 4: *(*string)(...) = dereference!      â”‚             â•‘
â•‘  â”‚  â†’ Láº¥y string VALUE ra!                      â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚  Káº¾T QUáº¢:                                     â”‚             â•‘
â•‘  â”‚  b ([]byte):                                  â”‚             â•‘
â•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚             â•‘
â•‘  â”‚  â”‚ ptr â”€â”€â†’ [H][E][L][L][O]â”‚ (0x100)          â”‚             â•‘
â•‘  â”‚  â”‚ len: 5  â”‚ cap: 5       â”‚                  â”‚             â•‘
â•‘  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚             â•‘
â•‘  â”‚             â”‚                                 â”‚             â•‘
â•‘  â”‚  s (string):â”‚ CÃ™NG DATA!                     â”‚             â•‘
â•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚             â•‘
â•‘  â”‚  â”‚ ptr â”€â”€â†’ [H][E][L][L][O]â”‚ (0x100) CÃ™NG!   â”‚             â•‘
â•‘  â”‚  â”‚ len: 5                  â”‚                  â”‚             â•‘
â•‘  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚  â†’ KHÃ”NG COPY! string TRá»CHUNG vÃ o data!   â”‚             â•‘
â•‘  â”‚  â†’ 0 allocation! 0 memcpy!                   â”‚             â•‘
â•‘  â”‚  â†’ NHANH!!! NhÆ°ng NGUY HIá»‚M!!!              â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â•‘
â•‘                                                               â•‘
â•‘  NGUY HIá»‚M:                                                    â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ b := []byte("HELLO")                          â”‚             â•‘
â•‘  â”‚ s := UnsafeBytesToString(b) // zero-copy!    â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ fmt.Println(s) // "HELLO" âœ…                 â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ b[0] = 'X' // Sá»¬A byte Ä‘áº§u tiÃªn!           â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ fmt.Println(s) // "XELLO" ğŸ’€ STRING Äá»”I!!  â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ â†’ string PHáº¢I immutable theo spec Go!        â”‚             â•‘
â•‘  â”‚ â†’ NHÆ¯NG unsafe bypass = string Bá»Š Äá»”I!     â”‚             â•‘
â•‘  â”‚ â†’ CÃ³ thá»ƒ gÃ¢y CRASH, data corruption!        â”‚             â•‘
â•‘  â”‚ â†’ Race condition náº¿u concurrent access!      â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â•‘
â•‘                                                               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## Â§4. unsafe.Pointer Deep Dive

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘   UNSAFE.POINTER â€” LUáº¬T CHÆ I!                                â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                               â•‘
â•‘  unsafe.Pointer LÃ€ GÃŒ?                                       â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚  = Con trá» KHÃ”NG CÃ“ TYPE!                   â”‚             â•‘
â•‘  â”‚  = "void*" trong C!                           â”‚             â•‘
â•‘  â”‚  = Cáº§u ná»‘i giá»¯a typed pointer â†” uintptr!   â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚  Normal Go:                                   â”‚             â•‘
â•‘  â”‚  *int â†’ chá»‰ trá» Ä‘áº¿n int!                   â”‚             â•‘
â•‘  â”‚  *string â†’ chá»‰ trá» Ä‘áº¿n string!             â”‚             â•‘
â•‘  â”‚  â†’ Type safe! Compiler kiá»ƒm tra!             â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚  unsafe.Pointer:                              â”‚             â•‘
â•‘  â”‚  â†’ Trá» Ä‘áº¿n Báº¤T Cá»¨ GÃŒ!                     â”‚             â•‘
â•‘  â”‚  â†’ Bypass type system!                        â”‚             â•‘
â•‘  â”‚  â†’ Compiler KHÃ”NG kiá»ƒm tra!                  â”‚             â•‘
â•‘  â”‚  â†’ Programmer Tá»° chá»‹u trÃ¡ch nhiá»‡m!        â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â•‘
â•‘                                                               â•‘
â•‘  CHUá»–I CHUYá»‚N Äá»”I:                                            â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚  *T â†â†’ unsafe.Pointer â†â†’ uintptr            â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚  *int â”€â”€â†’ unsafe.Pointer â”€â”€â†’ *float64        â”‚             â•‘
â•‘  â”‚     (cast)        (cast)                      â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚  Quy táº¯c:                                    â”‚             â•‘
â•‘  â”‚  â†’ *T â†’ unsafe.Pointer         âœ… OK!        â”‚             â•‘
â•‘  â”‚  â†’ unsafe.Pointer â†’ *T         âœ… OK!        â”‚             â•‘
â•‘  â”‚  â†’ unsafe.Pointer â†’ uintptr    âœ… OK!        â”‚             â•‘
â•‘  â”‚  â†’ uintptr â†’ unsafe.Pointer    âš ï¸ CHá»ˆ KHI   â”‚             â•‘
â•‘  â”‚    trong CÃ™NG 1 expression!                   â”‚             â•‘
â•‘  â”‚  â†’ *T â†’ *U trá»±c tiáº¿p           âŒ KHÃ”NG!    â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â•‘
â•‘                                                               â•‘
â•‘  6 PATTERNS Há»¢P Lá»† (tá»« Go spec):                            â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ 1. Chuyá»ƒn *T â†’ unsafe.Pointer â†’ *U           â”‚             â•‘
â•‘  â”‚    (Type punning â€” nhÆ° code máº«u!)            â”‚             â•‘
â•‘  â”‚    p := (*string)(unsafe.Pointer(&b))         â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ 2. unsafe.Pointer â†’ uintptr (arithmetic)     â”‚             â•‘
â•‘  â”‚    (TÃ­nh toÃ¡n offset field trong struct)      â”‚             â•‘
â•‘  â”‚    offset := unsafe.Offsetof(s.field)         â”‚             â•‘
â•‘  â”‚    p := unsafe.Pointer(uintptr(ptr) + offset) â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ 3. reflect.Value.Pointer/UnsafeAddr           â”‚             â•‘
â•‘  â”‚    â†’ unsafe.Pointer                           â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ 4. syscall.Syscall vá»›i unsafe.Pointer        â”‚             â•‘
â•‘  â”‚    â†’ Gá»i system calls!                       â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ âŒ INVALID: LÆ°u uintptr vÃ o biáº¿n rá»“i dÃ¹ng! â”‚             â•‘
â•‘  â”‚ âŒ INVALID: Arithmetic phá»©c táº¡p vá»›i uintptr! â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ u := uintptr(unsafe.Pointer(&x))              â”‚             â•‘
â•‘  â”‚ // ... GC cÃ³ thá»ƒ DI CHUYá»‚N x! ...            â”‚             â•‘
â•‘  â”‚ p := unsafe.Pointer(u) // ğŸ’€ DANGLING!       â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â•‘
â•‘                                                               â•‘
â•‘  KHI NÃ€O DÃ™NG unsafe?                                         â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ âœ… DÃ¹ng khi:                                  â”‚             â•‘
â•‘  â”‚ â†’ Hot path, Ä‘Ã£ profile, bottleneck RÃ• RÃ€NG! â”‚             â•‘
â•‘  â”‚ â†’ System programming (syscall, cgo)           â”‚             â•‘
â•‘  â”‚ â†’ Interop vá»›i C libraries                    â”‚             â•‘
â•‘  â”‚ â†’ Internal library (KHÃ”NG expose ra API)     â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ âŒ KHÃ”NG dÃ¹ng khi:                            â”‚             â•‘
â•‘  â”‚ â†’ ChÆ°a profile! "Premature optimization!"    â”‚             â•‘
â•‘  â”‚ â†’ Application code bÃ¬nh thÆ°á»ng!              â”‚             â•‘
â•‘  â”‚ â†’ CÃ³ thá»ƒ dÃ¹ng safe alternative!              â”‚             â•‘
â•‘  â”‚ â†’ Team khÃ´ng hiá»ƒu unsafe!                    â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â•‘
â•‘                                                               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## Â§5. Go Benchmarking CÆ¡ Báº£n

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘   GO BENCHMARKING â€” ÄO HIá»†U SUáº¤T!                            â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                               â•‘
â•‘  BENCHMARK LÃ€ GÃŒ?                                             â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ = ÄO thá»i gian cháº¡y cá»§a code!               â”‚             â•‘
â•‘  â”‚ = Tráº£ lá»i: "Code nÃ y NHANH bao nhiÃªu?"      â”‚             â•‘
â•‘  â”‚ = Go cung cáº¥p Sáº´N trong testing package!    â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â•‘
â•‘                                                               â•‘
â•‘  Cáº¤U TRÃšC CÆ  Báº¢N:                                            â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ func BenchmarkXxx(b *testing.B) {             â”‚             â•‘
â•‘  â”‚     for i := 0; i < b.N; i++ {                â”‚             â•‘
â•‘  â”‚         // code cáº§n Ä‘o!                      â”‚             â•‘
â•‘  â”‚     }                                         â”‚             â•‘
â•‘  â”‚ }                                             â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ â†’ TÃªn PHáº¢I báº¯t Ä‘áº§u báº±ng "Benchmark"!       â”‚             â•‘
â•‘  â”‚ â†’ Parameter: *testing.B (not *testing.T!)    â”‚             â•‘
â•‘  â”‚ â†’ b.N: Go runtime Tá»° Äá»˜NG chá»n!            â”‚             â•‘
â•‘  â”‚ â†’ Loop b.N láº§n Ä‘á»ƒ cÃ³ káº¿t quáº£ CHÃNH XÃC!    â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â•‘
â•‘                                                               â•‘
â•‘  b.N LÃ€ GÃŒ?                                                   â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ â†’ Go runtime Tá»° Äá»˜NG quyáº¿t Ä‘á»‹nh b.N!       â”‚             â•‘
â•‘  â”‚ â†’ Báº¯t Ä‘áº§u nhá»: b.N = 1                     â”‚             â•‘
â•‘  â”‚ â†’ TÄƒng dáº§n: 1 â†’ 100 â†’ 10000 â†’ 1000000...  â”‚             â•‘
â•‘  â”‚ â†’ Dá»«ng khi Ä‘á»§ THá»œI GIAN (máº·c Ä‘á»‹nh 1s)      â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ QuÃ¡ trÃ¬nh:                                    â”‚             â•‘
â•‘  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚             â•‘
â•‘  â”‚ â”‚ Láº§n cháº¡yâ”‚ b.N    â”‚ Tá»•ng thá»i gian   â”‚      â”‚             â•‘
â•‘  â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚             â•‘
â•‘  â”‚ â”‚ 1       â”‚ 1      â”‚ 0.001ms          â”‚      â”‚             â•‘
â•‘  â”‚ â”‚ 2       â”‚ 100    â”‚ 0.1ms            â”‚      â”‚             â•‘
â•‘  â”‚ â”‚ 3       â”‚ 10000  â”‚ 10ms             â”‚      â”‚             â•‘
â•‘  â”‚ â”‚ 4       â”‚ 1000000â”‚ 1000ms â‰ˆ 1s âœ…   â”‚      â”‚             â•‘
â•‘  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚             â•‘
â•‘  â”‚ â†’ Dá»«ng! BÃ¡o cÃ¡o: X ns/op                    â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â•‘
â•‘                                                               â•‘
â•‘  CÃCH CHáº Y:                                                    â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ # Cháº¡y Táº¤T Cáº¢ benchmarks                    â”‚             â•‘
â•‘  â”‚ go test -bench .                              â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ # KHÃ”NG cháº¡y unit test (chá»‰ bench)          â”‚             â•‘
â•‘  â”‚ go test -run none -bench .                    â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ # Cháº¡y 3 giÃ¢y (thay vÃ¬ 1s máº·c Ä‘á»‹nh)        â”‚             â•‘
â•‘  â”‚ go test -run none -bench . -benchtime 3s      â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ # Hiá»ƒn thá»‹ memory allocation!                â”‚             â•‘
â•‘  â”‚ go test -run none -bench . -benchmem          â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ # Cháº¡y benchmark Cá»¤ THá»‚                     â”‚             â•‘
â•‘  â”‚ go test -run none -bench BenchmarkSprint      â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ FLAGS:                                        â”‚             â•‘
â•‘  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚             â•‘
â•‘  â”‚ â”‚ Flag           â”‚ Ã nghÄ©a           â”‚      â”‚             â•‘
â•‘  â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚             â•‘
â•‘  â”‚ â”‚ -bench .       â”‚ Cháº¡y all bench     â”‚      â”‚             â•‘
â•‘  â”‚ â”‚ -bench Xxx     â”‚ Cháº¡y bench match   â”‚      â”‚             â•‘
â•‘  â”‚ â”‚ -run none      â”‚ Skip unit tests    â”‚      â”‚             â•‘
â•‘  â”‚ â”‚ -benchtime 3s  â”‚ Cháº¡y 3 giÃ¢y       â”‚      â”‚             â•‘
â•‘  â”‚ â”‚ -benchmem      â”‚ Report memory      â”‚      â”‚             â•‘
â•‘  â”‚ â”‚ -count 5       â”‚ Cháº¡y 5 láº§n        â”‚      â”‚             â•‘
â•‘  â”‚ â”‚ -cpuprofile p   â”‚ CPU profile        â”‚      â”‚             â•‘
â•‘  â”‚ â”‚ -memprofile m   â”‚ Memory profile     â”‚      â”‚             â•‘
â•‘  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â•‘
â•‘                                                               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## Â§6. Benchmark Sprint vs Sprintf â€” PhÃ¢n TÃ­ch Code Máº«u

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘   PHÃ‚N TÃCH BENCHMARK SPRINT vs SPRINTF                       â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                               â•‘
â•‘  CODE:                                                         â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â•‘
â•‘  â”‚ var gs string  // â† BIáº¾N GLOBAL! Táº¡i sao?   â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ func BenchmarkSprint(b *testing.B) {          â”‚             â•‘
â•‘  â”‚     var s string                              â”‚             â•‘
â•‘  â”‚     for i := 0; i < b.N; i++ {                â”‚             â•‘
â•‘  â”‚         s = fmt.Sprint("hello")               â”‚             â•‘
â•‘  â”‚     }                                         â”‚             â•‘
â•‘  â”‚     gs = s  // â† GÃN CHO GLOBAL!             â”‚             â•‘
â•‘  â”‚ }                                             â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ func BenchmarkSprintf(b *testing.B) {         â”‚             â•‘
â•‘  â”‚     var s string                              â”‚             â•‘
â•‘  â”‚     for i := 0; i < b.N; i++ {                â”‚             â•‘
â•‘  â”‚         s = fmt.Sprintf("hello")              â”‚             â•‘
â•‘  â”‚     }                                         â”‚             â•‘
â•‘  â”‚     gs = s  // â† GÃN CHO GLOBAL!             â”‚             â•‘
â•‘  â”‚ }                                             â”‚             â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â•‘
â•‘                                                               â•‘
â•‘  Táº I SAO Cáº¦N gs = s?                                          â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ âŒ Náº¿u KHÃ”NG cÃ³ gs = s:                       â”‚             â•‘
â•‘  â”‚ â†’ Compiler tháº¥y: "s khÃ´ng Ä‘Æ°á»£c dÃ¹ng á»Ÿ Ä‘Ã¢u!" â”‚             â•‘
â•‘  â”‚ â†’ Compiler cÃ³ thá»ƒ LOáº I Bá» toÃ n bá»™ loop!     â”‚             â•‘
â•‘  â”‚ â†’ Benchmark = Ä‘o... KHÃ”NG GÃŒ Cáº¢!            â”‚             â•‘
â•‘  â”‚ â†’ Káº¿t quáº£: 0 ns/op â€” SAI HOÃ€N TOÃ€N!        â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ âœ… CÃ³ gs = s:                                 â”‚             â•‘
â•‘  â”‚ â†’ s ÄÆ¯á»¢C DÃ™NG (gÃ¡n cho global)!              â”‚             â•‘
â•‘  â”‚ â†’ Compiler KHÃ”NG THá»‚ loáº¡i bá» loop!          â”‚             â•‘
â•‘  â”‚ â†’ Benchmark Ä‘o ÄÃšNG!                         â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ â†’ ÄÃ¢y lÃ  TRICK quan trá»ng nháº¥t trong         â”‚             â•‘
â•‘  â”‚   Go benchmarking!                            â”‚             â•‘
â•‘  â”‚ â†’ LUÃ”N gÃ¡n result cho package-level var!      â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â•‘
â•‘                                                               â•‘
â•‘  fmt.Sprint vs fmt.Sprintf:                                    â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚  fmt.Sprint("hello"):                         â”‚             â•‘
â•‘  â”‚  â†’ Nháº­n ...interface{}                        â”‚             â•‘
â•‘  â”‚  â†’ "hello" bá»‹ wrap vÃ o interface{}!         â”‚             â•‘
â•‘  â”‚  â†’ Box string â†’ interface = ALLOCATION!       â”‚             â•‘
â•‘  â”‚  â†’ Xá»­ lÃ½: reflect type â†’ format output      â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚  fmt.Sprintf("hello"):                        â”‚             â•‘
â•‘  â”‚  â†’ Nháº­n format string + ...interface{}       â”‚             â•‘
â•‘  â”‚  â†’ "hello" lÃ  format string, KHÃ”NG box!      â”‚             â•‘
â•‘  â”‚  â†’ KhÃ´ng cÃ³ args â†’ Ã­t xá»­ lÃ½ hÆ¡n             â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚  Káº¾T QUáº¢ BENCHMARK THAM KHáº¢O:                â”‚             â•‘
â•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚             â•‘
â•‘  â”‚  â”‚ Function      â”‚ ns/op    â”‚ allocs/op â”‚    â”‚             â•‘
â•‘  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚             â•‘
â•‘  â”‚  â”‚ Sprint        â”‚ ~100-150 â”‚ 1-2       â”‚    â”‚             â•‘
â•‘  â”‚  â”‚ Sprintf       â”‚ ~80-120  â”‚ 1         â”‚    â”‚             â•‘
â•‘  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚             â•‘
â•‘  â”‚  (Káº¿t quáº£ khÃ¡c nhau tÃ¹y Go version + CPU)    â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚  â†’ Sprintf THÆ¯á»œNG nhanh hÆ¡n Sprint!          â”‚             â•‘
â•‘  â”‚  â†’ VÃ¬ Sprint pháº£i box ALL args!              â”‚             â•‘
â•‘  â”‚  â†’ NhÆ°ng Cáº¢ HAI Ä‘á»u CHáº¬M so vá»›i +!          â”‚             â•‘
â•‘  â”‚  â†’ Concat Ä‘Æ¡n giáº£n? DÃ¹ng + hoáº·c strings.    â”‚             â•‘
â•‘  â”‚    Builder!                                    â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â•‘
â•‘                                                               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## Â§7. Best Practices Benchmarking

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘   BENCHMARK BEST PRACTICES                                    â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                               â•‘
â•‘  1. TRÃNH COMPILER OPTIMIZATION:                              â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ // âŒ Result cÃ³ thá»ƒ bá»‹ optimize Ä‘i!          â”‚             â•‘
â•‘  â”‚ func BenchmarkBad(b *testing.B) {             â”‚             â•‘
â•‘  â”‚     for i := 0; i < b.N; i++ {                â”‚             â•‘
â•‘  â”‚         compute()  // result bá»‹ bá»!         â”‚             â•‘
â•‘  â”‚     }                                         â”‚             â•‘
â•‘  â”‚ }                                             â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ // âœ… Giá»¯ result sá»‘ng báº±ng global var!       â”‚             â•‘
â•‘  â”‚ var result int                                â”‚             â•‘
â•‘  â”‚ func BenchmarkGood(b *testing.B) {            â”‚             â•‘
â•‘  â”‚     var r int                                 â”‚             â•‘
â•‘  â”‚     for i := 0; i < b.N; i++ {                â”‚             â•‘
â•‘  â”‚         r = compute()                         â”‚             â•‘
â•‘  â”‚     }                                         â”‚             â•‘
â•‘  â”‚     result = r                                â”‚             â•‘
â•‘  â”‚ }                                             â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â•‘
â•‘                                                               â•‘
â•‘  2. b.ResetTimer() â€” Bá» QUA SETUP TIME:                      â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ func BenchmarkWithSetup(b *testing.B) {       â”‚             â•‘
â•‘  â”‚     // Setup tá»‘n thá»i gian!                  â”‚             â•‘
â•‘  â”‚     data := loadLargeDataset()                â”‚             â•‘
â•‘  â”‚     index := buildIndex(data)                 â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚     b.ResetTimer() // â† RESET! Chá»‰ Ä‘o pháº§n â”‚             â•‘
â•‘  â”‚                    //   bÃªn dÆ°á»›i!             â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚     for i := 0; i < b.N; i++ {                â”‚             â•‘
â•‘  â”‚         index.Search("query")                 â”‚             â•‘
â•‘  â”‚     }                                         â”‚             â•‘
â•‘  â”‚ }                                             â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â•‘
â•‘                                                               â•‘
â•‘  3. b.StopTimer() / b.StartTimer() â€” PAUSE:                  â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ func BenchmarkWithPause(b *testing.B) {       â”‚             â•‘
â•‘  â”‚     for i := 0; i < b.N; i++ {                â”‚             â•‘
â•‘  â”‚         b.StopTimer()                         â”‚             â•‘
â•‘  â”‚         data := prepareInput(i) // khÃ´ng Ä‘o! â”‚             â•‘
â•‘  â”‚         b.StartTimer()                        â”‚             â•‘
â•‘  â”‚         process(data) // CHá»ˆ Ä‘o pháº§n nÃ y!   â”‚             â•‘
â•‘  â”‚     }                                         â”‚             â•‘
â•‘  â”‚ }                                             â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â•‘
â•‘                                                               â•‘
â•‘  4. Äá»ŒC Káº¾T QUáº¢ BENCHMARK:                                  â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ $ go test -bench . -benchmem                  â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ BenchmarkSprint-8   10000000   120 ns/op      â”‚             â•‘
â•‘  â”‚                     16 B/op    1 allocs/op    â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ Giáº£i thÃ­ch:                                   â”‚             â•‘
â•‘  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚             â•‘
â•‘  â”‚ â”‚ Column        â”‚ Ã nghÄ©a             â”‚      â”‚             â•‘
â•‘  â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚             â•‘
â•‘  â”‚ â”‚ Sprint-8      â”‚ TÃªn + 8 CPU cores   â”‚      â”‚             â•‘
â•‘  â”‚ â”‚ 10000000      â”‚ b.N = 10 triá»‡u láº§n â”‚      â”‚             â•‘
â•‘  â”‚ â”‚ 120 ns/op     â”‚ 120 nanosecond/call â”‚      â”‚             â•‘
â•‘  â”‚ â”‚ 16 B/op       â”‚ 16 bytes alloc/call â”‚      â”‚             â•‘
â•‘  â”‚ â”‚ 1 allocs/op   â”‚ 1 allocation/call   â”‚      â”‚             â•‘
â•‘  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ Má»¤C TIÃŠU:                                    â”‚             â•‘
â•‘  â”‚ â†’ ns/op: CÃ€NG THáº¤P CÃ€NG Tá»T!               â”‚             â•‘
â•‘  â”‚ â†’ B/op: CÃ€NG THáº¤P CÃ€NG Tá»T (Ã­t alloc)!    â”‚             â•‘
â•‘  â”‚ â†’ allocs/op: LÃ TÆ¯á»NG = 0!                  â”‚             â•‘
â•‘  â”‚   â†’ 0 allocs = khÃ´ng cÃ³ GC pressure!         â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â•‘
â•‘                                                               â•‘
â•‘  5. SO SÃNH BENCHMARKS (benchstat):                           â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ # Cháº¡y benchmark TRÆ¯á»šC optimize                â”‚             â•‘
â•‘  â”‚ go test -bench . -count 10 > old.txt          â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ # Sá»­a code...                                â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ # Cháº¡y benchmark SAU optimize                â”‚             â•‘
â•‘  â”‚ go test -bench . -count 10 > new.txt          â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ # So sÃ¡nh!                                    â”‚             â•‘
â•‘  â”‚ benchstat old.txt new.txt                     â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ # Output:                                     â”‚             â•‘
â•‘  â”‚ # name      old ns/op   new ns/op   delta    â”‚             â•‘
â•‘  â”‚ # Sprint    120 Â± 3%    85 Â± 2%    -29.17%   â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ â†’ Tháº¥y RÃ• improvement!                       â”‚             â•‘
â•‘  â”‚ â†’ Â± cho biáº¿t variance (dao Ä‘á»™ng)!            â”‚             â•‘
â•‘  â”‚ â†’ delta cho biáº¿t % cáº£i thiá»‡n!                â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â•‘
â•‘                                                               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## Â§8. Tá»•ng Káº¿t & CÃ¢u Há»i Phá»ng Váº¥n Senior Golang

### 8.1 CÃ¢u há»i phá»ng váº¥n

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘   CÃ‚U Há»I PHá»NG Váº¤N SENIOR GOLANG                            â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                               â•‘
â•‘  Q1: "string vs []byte trong Go?"                            â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â•‘
â•‘  â”‚ string: ptr + len (16 bytes), IMMUTABLE!      â”‚             â•‘
â•‘  â”‚ []byte: ptr + len + cap (24 bytes), MUTABLE! â”‚             â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ â†’ string(b) = COPY data! An toÃ n!            â”‚             â•‘
â•‘  â”‚ â†’ unsafe cast = ZERO COPY! Nguy hiá»ƒm!       â”‚             â•‘
â•‘  â”‚ â†’ string immutable = thread-safe by default! â”‚             â•‘
â•‘  â”‚ â†’ []byte mutable = cáº§n sync cho concurrent! â”‚             â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â•‘
â•‘                                                               â•‘
â•‘  Q2: "unsafe.Pointer dÃ¹ng khi nÃ o?"                          â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â•‘
â•‘  â”‚ â†’ CHá»ˆ khi Ä‘Ã£ profile vÃ  tÃ¬m tháº¥y bottleneck!â”‚             â•‘
â•‘  â”‚ â†’ System programming, cgo, syscall!            â”‚             â•‘
â•‘  â”‚ â†’ Bypass type system = NGUY HIá»‚M!            â”‚             â•‘
â•‘  â”‚ â†’ GC cÃ³ thá»ƒ di chuyá»ƒn objects!               â”‚             â•‘
â•‘  â”‚ â†’ Pháº£i tuÃ¢n thá»§ 6 patterns há»£p lá»‡ tá»« spec! â”‚             â•‘
â•‘  â”‚ â†’ KHÃ”NG lÆ°u uintptr vÃ o biáº¿n rá»“i dÃ¹ng láº¡i! â”‚             â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â•‘
â•‘                                                               â•‘
â•‘  Q3: "Giáº£i thÃ­ch b.N trong benchmark?"                       â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â•‘
â•‘  â”‚ â†’ Go runtime Tá»° Äá»˜NG chá»n b.N!              â”‚             â•‘
â•‘  â”‚ â†’ TÄƒng dáº§n: 1â†’100â†’10000â†’1000000...          â”‚             â•‘
â•‘  â”‚ â†’ Dá»«ng khi Ä‘á»§ thá»i gian (default 1s)!       â”‚             â•‘
â•‘  â”‚ â†’ KHÃ”NG tá»± set b.N!                          â”‚             â•‘
â•‘  â”‚ â†’ Result: ns/op = thá»i gian trung bÃ¬nh/láº§n! â”‚             â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â•‘
â•‘                                                               â•‘
â•‘  Q4: "Táº¡i sao cáº§n gÃ¡n result cho global var?"               â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â•‘
â•‘  â”‚ â†’ Compiler optimization: dead code eliminate! â”‚             â•‘
â•‘  â”‚ â†’ Náº¿u result khÃ´ng dÃ¹ng â†’ compiler Bá» loop! â”‚             â•‘
â•‘  â”‚ â†’ Benchmark Ä‘o 0 ns/op = SAI!                â”‚             â•‘
â•‘  â”‚ â†’ Global var = compiler PHáº¢I keep code!       â”‚             â•‘
â•‘  â”‚ â†’ Pattern: var gs T; ... gs = localResult    â”‚             â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â•‘
â•‘                                                               â•‘
â•‘  Q5: "Äá»c káº¿t quáº£ -benchmem?"                               â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â•‘
â•‘  â”‚ BenchmarkX-8  10000  120 ns/op  16 B/op  1   â”‚             â•‘
â•‘  â”‚   â”‚       â”‚    â”‚       â”‚         â”‚        â”‚    â”‚             â•‘
â•‘  â”‚   â”‚       â”‚    â”‚       â”‚         â”‚        â”” allocs/opâ•‘
â•‘  â”‚   â”‚       â”‚    â”‚       â”‚         â”” bytes allocated  â•‘
â•‘  â”‚   â”‚       â”‚    â”‚       â”” nanoseconds per operation  â•‘
â•‘  â”‚   â”‚       â”‚    â”” iterations (b.N)                   â•‘
â•‘  â”‚   â”‚       â”” GOMAXPROCS (CPU cores)                  â•‘
â•‘  â”‚   â”” benchmark name                                  â•‘
â•‘  â”‚                                              â”‚             â•‘
â•‘  â”‚ â†’ 0 allocs/op = TUYá»†T Vá»œI (no GC pressure!)â”‚             â•‘
â•‘  â”‚ â†’ Cao allocs = cáº§n optimize allocation!      â”‚             â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â•‘
â•‘                                                               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### 8.2 Tá»•ng káº¿t

```
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Tá»”NG Káº¾T: UNSAFE POINTER & BENCHMARKING                â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                                                          â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
    â”‚  â”‚ 1. string vs []byte:                      â”‚            â”‚
    â”‚  â”‚    â†’ CÃ¹ng 2 fields Ä‘áº§u (ptr + len)!      â”‚            â”‚
    â”‚  â”‚    â†’ string = IMMUTABLE (thread safe!)    â”‚            â”‚
    â”‚  â”‚    â†’ []byte = MUTABLE (cáº§n sync!)        â”‚            â”‚
    â”‚  â”‚                                          â”‚            â”‚
    â”‚  â”‚ 2. Safe conversion: string(b)             â”‚            â”‚
    â”‚  â”‚    â†’ COPY data! Allocation!                â”‚            â”‚
    â”‚  â”‚    â†’ An toÃ n 100%!                        â”‚            â”‚
    â”‚  â”‚                                          â”‚            â”‚
    â”‚  â”‚ 3. Unsafe conversion:                     â”‚            â”‚
    â”‚  â”‚    â†’ ZERO COPY! Reinterpret memory!       â”‚            â”‚
    â”‚  â”‚    â†’ Nguy hiá»ƒm! String bá»‹ mutable!       â”‚            â”‚
    â”‚  â”‚    â†’ Chá»‰ dÃ¹ng khi Ä‘Ã£ profile!            â”‚            â”‚
    â”‚  â”‚                                          â”‚            â”‚
    â”‚  â”‚ 4. Go Benchmarking:                       â”‚            â”‚
    â”‚  â”‚    â†’ func BenchmarkX(b *testing.B)        â”‚            â”‚
    â”‚  â”‚    â†’ b.N tá»± Ä‘á»™ng! for i < b.N!           â”‚            â”‚
    â”‚  â”‚    â†’ go test -bench . -benchmem           â”‚            â”‚
    â”‚  â”‚    â†’ PHáº¢I gÃ¡n result cho global var!      â”‚            â”‚
    â”‚  â”‚                                          â”‚            â”‚
    â”‚  â”‚ 5. Äá»c káº¿t quáº£:                          â”‚            â”‚
    â”‚  â”‚    â†’ ns/op: thá»i gian per call            â”‚            â”‚
    â”‚  â”‚    â†’ B/op: bytes allocated per call        â”‚            â”‚
    â”‚  â”‚    â†’ allocs/op: sá»‘ allocations per call  â”‚            â”‚
    â”‚  â”‚    â†’ benchstat: so sÃ¡nh old vs new!       â”‚            â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
    â”‚                                                          â”‚
    â”‚  William Kennedy:                                        â”‚
    â”‚  "Don't guess about performance.                         â”‚
    â”‚   MEASURE it with benchmarks!"                           â”‚
    â”‚                                                          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
